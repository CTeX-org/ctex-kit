% ctex-cjk-engine.def: for LaTeX engine with CJK
% vim:ft=tex

\ifCTEX@GBK
  \RequirePackage{CJK}[2003/03/28]
\else
  \RequirePackage{CJKutf8}[2003/03/28]
\fi

\ifCTEX@punct
  \RequirePackage{CJKpunct}[2009/05/06]
\fi

\ifCTEX@space
  \ifCTEX@GBK
    \def\CTEX@beginCJK{\begin{CJK}{GBK}{\CTEX@rm@family}}
  \else
    \def\CTEX@beginCJK{\begin{CJK}{UTF8}{\CTEX@rm@family}}
  \fi
  \def\CTEX@endCJK{\clearpage\end{CJK}}
\else
  \ifCTEX@GBK
    \def\CTEX@beginCJK{\begin{CJK*}{GBK}{\CTEX@rm@family}\CJKtilde}
  \else
    \def\CTEX@beginCJK{\begin{CJK*}{UTF8}{\CTEX@rm@family}\CJKtilde}
  \fi
  \def\CTEX@endCJK{\clearpage\end{CJK*}}
\fi

\AtEndOfPackage{\CJK@makeActive}
\AtEndPreamble{%
  \@ifpackageloaded{mathstyle}{% preload CJK env
    \ifCTEX@GBK
      \CJK{GBK}{}\endCJK
    \else
      \CJK{UTF8}{}\endCJK
    \fi}{}}

\let\CTEX@begindocumenthook\@begindocumenthook
\let\CTEX@enddocumenthook\@enddocumenthook
\def\AtBeginDocument{\g@addto@macro\CTEX@begindocumenthook}
\def\AtEndDocument{\g@addto@macro\CTEX@enddocumenthook}
\def\@begindocumenthook{\CTEX@begindocumenthook\CTEX@beginCJK}
\def\@enddocumenthook{\CTEX@endCJK\CTEX@enddocumenthook}

\input{ctex-cjk-common.def}

\providecommand*\CTEX@rm@family{gbsn}
\providecommand*\CTEX@sf@family{gbsn}
\providecommand*\CTEX@tt@family{gbsn}

\ifCTEX@fontset
\InputIfFileExists{ctex-cjk-\CTEX@fontset.def}%
  {\PackageInfo{ctex}{CJK fontset '\CTEX@fontset' is loaded.}}%
  {\PackageWarning{ctex}{CJK fontset '\CTEX@fontset' is undefined. Trying 'nofonts' fontset.}}
\fi

\appto\rmfamily{\CJKfamily{\CTEX@rm@family}}
\appto\sffamily{\CJKfamily{\CTEX@sf@family}}
\appto\ttfamily{\CJKfamily{\CTEX@tt@family}}
\appto\normalfont{\CJKfamily{\CTEX@rm@family}}

\endinput
